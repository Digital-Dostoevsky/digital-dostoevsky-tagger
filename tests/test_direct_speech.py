import pytest

from tagger.direct_speech import markup_direct_speech, ATTRIBS

examples = [
    # guillemets
    ("«Поди узнай, кто это»", "<said>«Поди узнай, кто это»</said>"),
    (
        "А по правде, ужасно любил сразиться в карточки, за что, и особенно в последнее время, имел частые и неприятные стычки с Варварой Петровной, тем более что постоянно проигрывал. Но об этом после. Замечу лишь, что это был человек даже совестливый (то есть иногда), а потому часто грустил. В продолжение всей двадцатилетней дружбы с Варварой Петровной он раза по три и по четыре в год регулярно впадал в так называемую между нами «гражданскую скорбь», то есть просто в хандру, но словечко это нравилось многоуважаемой Варваре Петровне. Впоследствии, кроме гражданской скорби, он стал впадать и в шампанское; но чуткая Варвара Петровна всю жизнь охраняла его от всех тривиальных наклонностей. Да он и нуждался в няньке, потому что становился иногда очень странен: в средине самой возвышенной скорби он вдруг зачинал смеяться самым простонароднейшим образом. Находили минуты, что даже о самом себе начинал выражаться в юмористическом смысле. Но ничего так не боялась Варвара Петровна, как юмористического смысла. Это была женщина-классик, женщина-меценатка, действовавшая в видах одних лишь высших соображений. Капитально было двадцатилетнее влияние этой высшей дамы на ее бедного друга. О ней надо бы поговорить особенно, что я и сделаю.",
        "А по правде, ужасно любил сразиться в карточки, за что, и особенно в последнее время, имел частые и неприятные стычки с Варварой Петровной, тем более что постоянно проигрывал. Но об этом после. Замечу лишь, что это был человек даже совестливый (то есть иногда), а потому часто грустил. В продолжение всей двадцатилетней дружбы с Варварой Петровной он раза по три и по четыре в год регулярно впадал в так называемую между нами <said>«гражданскую скорбь»</said>, то есть просто в хандру, но словечко это нравилось многоуважаемой Варваре Петровне. Впоследствии, кроме гражданской скорби, он стал впадать и в шампанское; но чуткая Варвара Петровна всю жизнь охраняла его от всех тривиальных наклонностей. Да он и нуждался в няньке, потому что становился иногда очень странен: в средине самой возвышенной скорби он вдруг зачинал смеяться самым простонароднейшим образом. Находили минуты, что даже о самом себе начинал выражаться в юмористическом смысле. Но ничего так не боялась Варвара Петровна, как юмористического смысла. Это была женщина-классик, женщина-меценатка, действовавшая в видах одних лишь высших соображений. Капитально было двадцатилетнее влияние этой высшей дамы на ее бедного друга. О ней надо бы поговорить особенно, что я и сделаю.",
    ),
    # -- with inquit set off with emdash
    (
        "«Не будет ли каких приказаний?» — ничего не ответил.",
        "<said>«Не будет ли каких приказаний?»</said> — ничего не ответил.",
    ),
    # emdashes
    (
        "— Вы не рекомендовались, но я имел удовольствие видеть вас однажды, еще года четыре назад, здесь в монастыре... случайно.",
        "— <said>Вы не рекомендовались, но я имел удовольствие видеть вас однажды, еще года четыре назад, здесь в монастыре... случайно.</said>",
    ),
    # -- with inquit set off with comma and emdash
    (
        "— Лесть и трусость — самые дурные пороки, — громко промолвила Ася",
        "— <said>Лесть и трусость — самые дурные пороки</said>, — громко промолвила Ася",
    ),
    # -- with inquit inset in the middle of the utterance
    (
        "— Вы меня знаете? — спросил он вдруг отрывисто, — рекомендовался я вам или нет, когда вошел? Я так рассеян...",
        "— <said>Вы меня знаете?</said> — спросил он вдруг отрывисто, — <said>рекомендовался я вам или нет, когда вошел? Я так рассеян...</said>",
    ),
    # -- with inquit inset in the middle of the utterance and post-utterance content
    (
        "— Ну, я очень рада, — сказала жена, — так теперь ты, смотри ж, принимай аккуратно лекарство. Дай рецепт, я пошлю Герасима в аптеку. — И она пошла одеваться.",
        "— <said>Ну, я очень рада</said>, — сказала жена, — <said>так теперь ты, смотри ж, принимай аккуратно лекарство. Дай рецепт, я пошлю Герасима в аптеку.</said> — И она пошла одеваться.",
    ),
    # -- with emdash indicating implicit existential verb
    (
        "—	Нет, я — сын дворового человека, бывшего крепостного.",
        "— <said>Нет, я — сын дворового человека, бывшего крепостного.</said>",
    ),
    # -- with inquit set off with emdash (no comma, question mark indicates end of utterance)
    (
        "— А я? — спрашивал Липутин.",
        "— <said>А я?</said> — спрашивал Липутин.",
    ),
    # -- with inquit set off with emdash (no comma, exclamation mark indicates end of utterance)
    (
        "— Карамазов! — крикнул Коля, — неужели и взаправду религия говорит, что мы все встанем из мертвых, и оживем, и увидим опять друг друга, и всех, и Илюшечку?",
        "— <said>Карамазов!</said> — крикнул Коля, — <said>неужели и взаправду религия говорит, что мы все встанем из мертвых, и оживем, и увидим опять друг друга, и всех, и Илюшечку?</said>",
    ),
    (
        "— Слава тебе господи! — проговорила она горячим, проникновенным голосом и, еще не садясь на место и обратившись к Николаю Парфеновичу, прибавила: — Как он теперь сказал, тому и верьте! Знаю его: сболтнуть что сболтнет, али для смеху, али с упрямства, но если против совести, то никогда не обманет. Прямо правду скажет, тому верьте!",
        "— <said>Слава тебе господи!</said> — проговорила она горячим, проникновенным голосом и, еще не садясь на место и обратившись к Николаю Парфеновичу, прибавила: — <said>Как он теперь сказал, тому и верьте! Знаю его: сболтнуть что сболтнет, али для смеху, али с упрямства, но если против совести, то никогда не обманет. Прямо правду скажет, тому верьте!</said>",
    ),
    # -- utterance continues with emdash following a colon
    (
        "— Николай, Николай Иванов Красоткин, или, как говорят по-казенному, сын Красоткин, — чему-то засмеялся Коля, но вдруг прибавил: — Я, разумеется, ненавижу мое имя Николай.",
        "— <said>Николай, Николай Иванов Красоткин, или, как говорят по-казенному, сын Красоткин</said>, — чему-то засмеялся Коля, но вдруг прибавил: — <said>Я, разумеется, ненавижу мое имя Николай.</said>",
    ),
    # -- utterance continues with emdash following a semicolon
    (
        "— Это очень хорошо, что ты сам его поведешь, — заметил Зосимов Разумихину; — что завтра будет, увидим, а сегодня очень даже недурно: значительная перемена с давешнего. Век живи, век учись...",
        "— <said>Это очень хорошо, что ты сам его поведешь</said>, — заметил Зосимов Разумихину; — <said>что завтра будет, увидим, а сегодня очень даже недурно: значительная перемена с давешнего. Век живи, век учись...</said>",
    ),
    # -- utterance includes parenthetical translation (used in Братья Карамазовы)
    (
        "— Ото бардзо пенкне! (Вот так хорошо!) — крикнул другой пан, и оба разом осушили свои стаканы.",
        "— <said>Ото бардзо пенкне! (Вот так хорошо!)</said> — крикнул другой пан, и оба разом осушили свои стаканы.",
    ),
    # -- with inquit set off with emdash (no comma, period indicates end of utterance)
    (
        "— Знамо дело, при них буду, христиане и мы тоже. — Старуха, говоря это, плакала.",
        "— <said>Знамо дело, при них буду, христиане и мы тоже.</said> — Старуха, говоря это, плакала.",
    ),
    #
    (
        "— Да, ничего, может, так и надо... — раздумчиво промолвил Николай Всеволодович. — Только записок больше ко мне не пишите, прошу вас.",
        "— <said>Да, ничего, может, так и надо...</said> — раздумчиво промолвил Николай Всеволодович. — <said>Только записок больше ко мне не пишите, прошу вас.</said>",
    ),
    #
    (
        "— Получил тогда же.",
        "— <said>Получил тогда же.</said>",
    ),
    #
    (
        "—	Друг мой, если б я только знал... — протянул Версилов с небрежной улыбкой несколько утомленного человека, — каков, однако, негодяй этот Тушар! Впрочем, я всё еще не теряю надежды, что ты как-нибудь соберешься с силами и всё это нам наконец простишь и мы опять заживем как нельзя лучше.",
        "— <said>Друг мой, если б я только знал...</said> — протянул Версилов с небрежной улыбкой несколько утомленного человека, — <said>каков, однако, негодяй этот Тушар! Впрочем, я всё еще не теряю надежды, что ты как-нибудь соберешься с силами и всё это нам наконец простишь и мы опять заживем как нельзя лучше.</said>",
    ),
    # Multi-line problems...
    (
        """
— Получил тогда же.
— Это уж я не по «бездарности», это я искренно, от готовности. Если вышло бездарно, то зато было искренно.
        """,
        """
— <said>Получил тогда же.</said>
— <said>Это уж я не по <said>«бездарности»</said>, это я искренно, от готовности. Если вышло бездарно, то зато было искренно.</said>
        """,
    ),
    #
    (
        """
Я промолчал. Он тоже очень долго молчал.
— Говорят, французский ум... — залепетал он вдруг точно в жару, — это ложь, это всегда так и было. Зачем клеветать на французский ум?
        """,
        """
Я промолчал. Он тоже очень долго молчал.
— <said>Говорят, французский ум...</said> — залепетал он вдруг точно в жару, — <said>это ложь, это всегда так и было. Зачем клеветать на французский ум?</said>
        """,
    ),
    (
        "А между тем, когда один пьяный, которого неизвестно почему и куда провозили в это время по улице в огромной телеге, запряженной огромною ломовою лошадью, крикнул ему вдруг, проезжая: «Эй ты, немецкий шляпник!» — и заорал во всё горло, указывая на него рукой, — молодой человек вдруг остановился и судорожно схватился за свою шляпу. Шляпа эта была высокая, круглая, циммермановская, но вся уже изношенная, совсем рыжая, вся в дырах и пятнах, без полей и самым безобразнейшим углом заломившаяся на сторону. Но не стыд, а совсем другое чувство, похожее даже на испуг, охватило его.",
        "А между тем, когда один пьяный, которого неизвестно почему и куда провозили в это время по улице в огромной телеге, запряженной огромною ломовою лошадью, крикнул ему вдруг, проезжая: <said>«Эй ты, немецкий шляпник!»</said> — и заорал во всё горло, указывая на него рукой, — молодой человек вдруг остановился и судорожно схватился за свою шляпу. Шляпа эта была высокая, круглая, циммермановская, но вся уже изношенная, совсем рыжая, вся в дырах и пятнах, без полей и самым безобразнейшим углом заломившаяся на сторону. Но не стыд, а совсем другое чувство, похожее даже на испуг, охватило его.",
    ),
    (
        "«На какое дело хочу покуситься и в то же время каких пустяков боюсь! — подумал он с странною улыбкой. — Гм... да... всё в руках человека, и всё-то он мимо носу проносит, единственно от одной трусости... это уж аксиома... Любопытно, чего люди больше всего боятся? Нового шага, нового собственного слова они всего больше боятся... А впрочем, я слишком много болтаю. Оттого и ничего не делаю, что болтаю. Пожалуй, впрочем, и так: оттого болтаю, что ничего не делаю. Это я в этот последний месяц выучился болтать, лежа по целым суткам в углу и думая... о царе Горохе. Ну зачем я теперь иду? Разве я способен на это? Разве это серьезно? Совсем не серьезно. Так, ради фантазии сам себя тешу; игрушки! Да, пожалуй что и игрушки!»",
        "<said>«На какое дело хочу покуситься и в то же время каких пустяков боюсь!</said> — подумал он с странною улыбкой. — <said>Гм... да... всё в руках человека, и всё-то он мимо носу проносит, единственно от одной трусости... это уж аксиома... Любопытно, чего люди больше всего боятся? Нового шага, нового собственного слова они всего больше боятся... А впрочем, я слишком много болтаю. Оттого и ничего не делаю, что болтаю. Пожалуй, впрочем, и так: оттого болтаю, что ничего не делаю. Это я в этот последний месяц выучился болтать, лежа по целым суткам в углу и думая... о царе Горохе. Ну зачем я теперь иду? Разве я способен на это? Разве это серьезно? Совсем не серьезно. Так, ради фантазии сам себя тешу; игрушки! Да, пожалуй что и игрушки!»</said>",
    ),
    (
        "стало быть, должен же был себя хоть этим вознаградить. (Плохая острота; но я ее не вычеркну. Я ее написал, думая, что выйдет очень остро; а теперь, как увидел сам, что хотел только гнусно пофорсить, — нарочно не вычеркну!) Когда к столу, у которого я сидел, подходили, бывало, просители за справками, — я зубами на них скрежетал и чувствовал неутолимое наслаждение, когда удавалось кого-нибудь огорчить. Почти всегда удавалось. Большею частию всё был народ робкий: известно — просители. Но из фертов я особенно терпеть не мог одного офицера. Он никак не хотел покориться и омерзительно гремел саблей. У меня с ним полтора года за эту саблю война была. Я наконец одолел. Он перестал греметь. Впрочем, это случилось еще в моей молодости. Но знаете ли, господа, в чем состоял главный пункт моей злости? Да в том-то и состояла вся штука, в том-то и заключалась наибольшая гадость, что я поминутно, даже в минуту самой сильнейшей желчи, постыдно сознавал в себе, что я не только не злой, но даже и не озлобленный человек, что я только воробьев пугаю напрасно и себя этим тешу. У меня пена у рта, а принесите мне какую-нибудь куколку, дайте мне чайку с сахарцем, я, пожалуй, и успокоюсь. Даже душой умилюсь, хоть уж, наверно, потом буду сам на себя скрежетать зубами и от стыда несколько месяцев страдать бессонницей. Таков уж мой обычай.",
        "стало быть, должен же был себя хоть этим вознаградить. (Плохая острота; но я ее не вычеркну. Я ее написал, думая, что выйдет очень остро; а теперь, как увидел сам, что хотел только гнусно пофорсить, — нарочно не вычеркну!) Когда к столу, у которого я сидел, подходили, бывало, просители за справками, — я зубами на них скрежетал и чувствовал неутолимое наслаждение, когда удавалось кого-нибудь огорчить. Почти всегда удавалось. Большею частию всё был народ робкий: известно — просители. Но из фертов я особенно терпеть не мог одного офицера. Он никак не хотел покориться и омерзительно гремел саблей. У меня с ним полтора года за эту саблю война была. Я наконец одолел. Он перестал греметь. Впрочем, это случилось еще в моей молодости. Но знаете ли, господа, в чем состоял главный пункт моей злости? Да в том-то и состояла вся штука, в том-то и заключалась наибольшая гадость, что я поминутно, даже в минуту самой сильнейшей желчи, постыдно сознавал в себе, что я не только не злой, но даже и не озлобленный человек, что я только воробьев пугаю напрасно и себя этим тешу. У меня пена у рта, а принесите мне какую-нибудь куколку, дайте мне чайку с сахарцем, я, пожалуй, и успокоюсь. Даже душой умилюсь, хоть уж, наверно, потом буду сам на себя скрежетать зубами и от стыда несколько месяцев страдать бессонницей. Таков уж мой обычай.",
    ),
    (
        "«Помилуйте, — закричат вам, — восставать нельзя: это дважды два четыре! Природа вас не спрашивается; ей дела нет до ваших желаний и до того, нравятся ль вам ее законы или не нравятся. Вы обязаны принимать ее так, как она есть, а следственно, и все ее результаты. Стена, значит, и есть стена... и т. д., и т. д.». Господи боже, да какое мне дело до законов природы и арифметики, когда мне почему-нибудь эти законы и дважды два четыре не нравятся? Разумеется, я не пробью такой стены лбом, если и в самом деле сил не будет пробить, но я и не примирюсь с ней потому только, что у меня каменная стена и у меня сил не хватило.",
        "<said>«Помилуйте</said>, — закричат вам, — <said>восставать нельзя: это дважды два четыре! Природа вас не спрашивается; ей дела нет до ваших желаний и до того, нравятся ль вам ее законы или не нравятся. Вы обязаны принимать ее так, как она есть, а следственно, и все ее результаты. Стена, значит, и есть стена... и т. д., и т. д.»</said>. Господи боже, да какое мне дело до законов природы и арифметики, когда мне почему-нибудь эти законы и дважды два четыре не нравятся? Разумеется, я не пробью такой стены лбом, если и в самом деле сил не будет пробить, но я и не примирюсь с ней потому только, что у меня каменная стена и у меня сил не хватило.",
    ),
    (
        """
— И не в чем мне у вас прощения просить, — продолжал он, как бы совсем не замечая моих криков, — потому вы же обозвали меня «палачом», на чем я с вас могу в квартале всегда за обиду просить.
— Иди! Проси! — заревел я, — иди сейчас, сию минуту, сию секунду! А ты все-таки палач! палач! палач! — Но он только посмотрел на меня, затем повернулся и, уже не слушая призывных криков моих, плавно пошел к себе, не оборачиваясь.
        """,
        """
— <said>И не в чем мне у вас прощения просить</said>, — продолжал он, как бы совсем не замечая моих криков, — <said>потому вы же обозвали меня <said>«палачом»</said>, на чем я с вас могу в квартале всегда за обиду просить.</said>
— <said>Иди! Проси!</said> — заревел я, — <said>иди сейчас, сию минуту, сию секунду! А ты все-таки палач! палач! палач!</said> — Но он только посмотрел на меня, затем повернулся и, уже не слушая призывных криков моих, плавно пошел к себе, не оборачиваясь.
        """,
    ),
    (
        "«Да и не пустят ее, „мерзавку“! — думал я. — Их ведь, кажется, гулять-то не очень пускают, тем более вечером (мне почему-то непременно казалось, что она должна прийти вечером и именно в семь часов). А впрочем, она сказала, что еще не совсем там закабалилась, на особых правах состоит; значит, гм! Черт возьми, придет, непременно придет!»",
        "<said>«Да и не пустят ее, „мерзавку“!</said> — думал я. — <said>Их ведь, кажется, гулять-то не очень пускают, тем более вечером (мне почему-то непременно казалось, что она должна прийти вечером и именно в семь часов). А впрочем, она сказала, что еще не совсем там закабалилась, на особых правах состоит; значит, гм! Черт возьми, придет, непременно придет!»</said>",
    ),
    (
        "«dans le pays de Makar et de ses veaux» означала: «куда Макар телят не гонял». Степан Трофимович нарочно глупейшим образом переводил иногда русские пословицы и коренные поговорки на французский язык, без сомнения умея и понять и перевести лучше; но это он делывал из особого рода шику и находил его остроумным. Но погулял он немного, четырех месяцев не выдержал и примчался в Скворешники. Последние письма его состояли из одних лишь излияний самой чувствительной любви к своему отсутствующему другу и буквально были смочены слезами разлуки. Есть натуры, чрезвычайно приживающиеся к дому, точно комнатные собачки. Свидание друзей было восторженное. Через два дня всё пошло по-старому и даже скучнее старого. «Друг мой, — говорил мне Степан Трофимович через две недели, под величайшим секретом, — друг мой, я открыл ужасную для меня... новость: je suis un простой приживальщик, et rien de plus! Mais r-r-rien de plus!»",
        "<said>«dans le pays de Makar et de ses veaux»</said> означала: <said>«куда Макар телят не гонял»</said>. Степан Трофимович нарочно глупейшим образом переводил иногда русские пословицы и коренные поговорки на французский язык, без сомнения умея и понять и перевести лучше; но это он делывал из особого рода шику и находил его остроумным. Но погулял он немного, четырех месяцев не выдержал и примчался в Скворешники. Последние письма его состояли из одних лишь излияний самой чувствительной любви к своему отсутствующему другу и буквально были смочены слезами разлуки. Есть натуры, чрезвычайно приживающиеся к дому, точно комнатные собачки. Свидание друзей было восторженное. Через два дня всё пошло по-старому и даже скучнее старого. <said>«Друг мой</said>, — говорил мне Степан Трофимович через две недели, под величайшим секретом, — <said>друг мой, я открыл ужасную для меня... новость: je suis un простой приживальщик, et rien de plus! Mais r-r-rien de plus!»</said>",
    ),
    (
        "Все мы, близкие, понимали, — а Степан Трофимович чувствительнее всех нас, — что сын явился пред нею теперь как бы в виде новой надежды и даже в виде какой-то новой мечты. Страсть ее к сыну началась со времени удач его в петербургском обществе и особенно усилилась с той минуты, когда получено было известие о разжаловании его в солдаты. А между тем она очевидно боялась его и казалась пред ним словно рабой. Заметно было, что она боялась чего-то неопределенного, таинственного, чего и сама не могла бы высказать, и много раз неприметно и пристально приглядывалась к Nicolas, что-то соображая и разгадывая... и вот — зверь вдруг выпустил свои когти. ",
        "Все мы, близкие, понимали, — а Степан Трофимович чувствительнее всех нас, — что сын явился пред нею теперь как бы в виде новой надежды и даже в виде какой-то новой мечты. Страсть ее к сыну началась со времени удач его в петербургском обществе и особенно усилилась с той минуты, когда получено было известие о разжаловании его в солдаты. А между тем она очевидно боялась его и казалась пред ним словно рабой. Заметно было, что она боялась чего-то неопределенного, таинственного, чего и сама не могла бы высказать, и много раз неприметно и пристально приглядывалась к Nicolas, что-то соображая и разгадывая... и вот — зверь вдруг выпустил свои когти. ",
    ),
    (
        "Алексей Федорович Карамазов был третьим сыном помещика нашего уезда Федора Павловича Карамазова, столь известного в свое время (да и теперь еще у нас припоминаемого) по трагической и темной кончине своей, приключившейся ровно тринадцать лет назад и о которой сообщу в своем месте. Теперь же скажу об этом «помещике» (как его у нас называли, хотя он всю жизнь совсем почти не жил в своем поместье) лишь то, что это был странный тип, довольно часто, однако, встречающийся, именно тип человека не только дрянного и развратного, но вместе с тем и бестолкового, — но из таких, однако, бестолковых, которые умеют отлично обделывать свои имущественные делишки, и только, кажется, одни эти. Федор Павлович, например, начал почти что ни с чем, помещик он был самый маленький, бегал обедать по чужим столам, норовил в приживальщики, а между тем в момент кончины его у него оказалось до ста тысяч рублей чистыми деньгами. И в то же время он все-таки всю жизнь свою продолжал быть одним из бестолковейших сумасбродов по всему нашему уезду. Повторю еще: тут не глупость; большинство этих сумасбродов довольно умно и хитро, — а именно бестолковость, да еще какая-то особенная, национальная. ",
        "Алексей Федорович Карамазов был третьим сыном помещика нашего уезда Федора Павловича Карамазова, столь известного в свое время (да и теперь еще у нас припоминаемого) по трагической и темной кончине своей, приключившейся ровно тринадцать лет назад и о которой сообщу в своем месте. Теперь же скажу об этом <said>«помещике»</said> (как его у нас называли, хотя он всю жизнь совсем почти не жил в своем поместье) лишь то, что это был странный тип, довольно часто, однако, встречающийся, именно тип человека не только дрянного и развратного, но вместе с тем и бестолкового, — но из таких, однако, бестолковых, которые умеют отлично обделывать свои имущественные делишки, и только, кажется, одни эти. Федор Павлович, например, начал почти что ни с чем, помещик он был самый маленький, бегал обедать по чужим столам, норовил в приживальщики, а между тем в момент кончины его у него оказалось до ста тысяч рублей чистыми деньгами. И в то же время он все-таки всю жизнь свою продолжал быть одним из бестолковейших сумасбродов по всему нашему уезду. Повторю еще: тут не глупость; большинство этих сумасбродов довольно умно и хитро, — а именно бестолковость, да еще какая-то особенная, национальная. ",
    ),
    (
        "«На какое дело хочу покуситься и в то же время каких пустяков боюсь! — подумал он с странною улыбкой. — Гм... да... всё в руках человека, и всё-то он мимо носу проносит, единственно от одной трусости... это уж аксиома... Любопытно, чего люди больше всего боятся? Нового шага, нового собственного слова они всего больше боятся... А впрочем, я слишком много болтаю. Оттого и ничего не делаю, что болтаю. Пожалуй, впрочем, и так: оттого болтаю, что ничего не делаю. Это я в этот последний месяц выучился болтать, лежа по целым суткам в углу и думая... о царе Горохе. Ну зачем я теперь иду? Разве я способен на это? Разве это серьезно? Совсем не серьезно. Так, ради фантазии сам себя тешу; игрушки! Да, пожалуй что и игрушки!»",
        "<said>«На какое дело хочу покуситься и в то же время каких пустяков боюсь!</said> — подумал он с странною улыбкой. — <said>Гм... да... всё в руках человека, и всё-то он мимо носу проносит, единственно от одной трусости... это уж аксиома... Любопытно, чего люди больше всего боятся? Нового шага, нового собственного слова они всего больше боятся... А впрочем, я слишком много болтаю. Оттого и ничего не делаю, что болтаю. Пожалуй, впрочем, и так: оттого болтаю, что ничего не делаю. Это я в этот последний месяц выучился болтать, лежа по целым суткам в углу и думая... о царе Горохе. Ну зачем я теперь иду? Разве я способен на это? Разве это серьезно? Совсем не серьезно. Так, ради фантазии сам себя тешу; игрушки! Да, пожалуй что и игрушки!»</said>",
    ),
    (
        "Оставаться долее в Петербурге было, разумеется, невозможно, тем более что и Степана Трофимовича постигло окончательное fiasco. Он не выдержал и стал заявлять о правах искусства, а над ним стали еще громче смеяться. На последнем чтении своем он задумал подействовать гражданским красноречием, воображая тронуть сердца и рассчитывая на почтение к своему «изгнанию». Он бесспорно согласился в бесполезности и комичности слова «отечество»; согласился и с мыслию о вреде религии, но громко и твердо заявил, что сапоги ниже Пушкина, и даже гораздо. Его безжалостно освистали, так что он тут же, публично, не сойдя с эстрады, расплакался. Варвара Петровна привезла его домой едва живого. «On m’a traité соmmе un vieux bonnet de coton!» — лепетал он бессмысленно. Она ходила за ним всю ночь, давала ему лавровишневых капель и до рассвета повторяла ему: «Вы еще полезны; вы еще явитесь; вас оценят... в другом месте».",
        "Оставаться долее в Петербурге было, разумеется, невозможно, тем более что и Степана Трофимовича постигло окончательное fiasco. Он не выдержал и стал заявлять о правах искусства, а над ним стали еще громче смеяться. На последнем чтении своем он задумал подействовать гражданским красноречием, воображая тронуть сердца и рассчитывая на почтение к своему <said>«изгнанию»</said>. Он бесспорно согласился в бесполезности и комичности слова <said>«отечество»</said>; согласился и с мыслию о вреде религии, но громко и твердо заявил, что сапоги ниже Пушкина, и даже гораздо. Его безжалостно освистали, так что он тут же, публично, не сойдя с эстрады, расплакался. Варвара Петровна привезла его домой едва живого. <said>«On m’a traité соmmе un vieux bonnet de coton!»</said> — лепетал он бессмысленно. Она ходила за ним всю ночь, давала ему лавровишневых капель и до рассвета повторяла ему: <said>«Вы еще полезны; вы еще явитесь; вас оценят... в другом месте»</said>.",
    ),
    (
        "Он со слезами вспоминал об этом девять лет спустя, — впрочем, скорее по художественности своей натуры, чем из благодарности. «Клянусь же вам и пари держу, — говорил он мне сам (но только мне и по секрету), — что никто-то изо всей этой публики знать не знал о мне ровнешенько ничего!» Признание замечательное: стало быть, был же в нем острый ум, если он тогда же, на эстраде, мог так ясно понять свое положение, несмотря на всё свое упоение; и, стало быть, не было в нем острого ума, если он даже девять лет спустя не мог вспомнить о том без ощущения обиды. Его заставили подписаться под двумя или тремя коллективными протестами (против чего — он и сам не знал); он подписался. Варвару Петровну тоже заставили подписаться под каким-то «безобразным поступком», и та подписалась. Впрочем, большинство этих новых людей хоть и посещали Варвару Петровну, но считали себя почему-то обязанными смотреть на нее с презрением и с нескрываемою насмешкой. Степан Трофимович намекал мне потом, в горькие минуты, что она с тех-то пор ему и позавидовала. Она, конечно, понимала, что ей нельзя водиться с этими людьми, но все-таки принимала их с жадностию, со всем женским истерическим нетерпением и, главное, всё чего-то ждала. На вечерах она говорила мало, хотя и могла бы говорить; но она больше вслушивалась. Говорили об уничтожении цензуры и буквы ъ, о заменении русских букв латинскими, о вчерашней ссылке такого-то, о каком-то скандале в Пассаже, о полезности раздробления России по народностям с вольною федеративною связью, об уничтожении армии и флота, о восстановлении Польши по Днепр, о крестьянской реформе и прокламациях, об уничтожении наследства, семейства, детей и священников, о правах женщины, о доме Краевского, которого никто и никогда не мог простить господину Краевскому, и пр., и пр. Ясно было, что в этом сброде новых людей много мошенников, но несомненно было, что много и честных, весьма даже привлекательных лиц, несмотря на некоторые все-таки удивительные оттенки. Честные были гораздо непонятнее бесчестных и грубых; но неизвестно было, кто у кого в руках. Когда Варвара Петровна объявила свою мысль об издании журнала, то к ней хлынуло еще больше народу, но тотчас же посыпались в глаза обвинения, что она капиталистка и эксплуатирует труд. Бесцеремонность обвинений равнялась только их неожиданности. Престарелый генерал Иван Иванович Дроздов, прежний друг и сослуживец покойного генерала Ставрогина, человек достойнейший (но в своем роде) и которого все мы здесь знаем, до крайности строптивый и раздражительный, ужасно много евший и ужасно боявшийся атеизма, заспорил на одном из вечеров Варвары Петровны с одним знаменитым юношей. Тот ему первым словом: «Вы, стало быть, генерал, если так говорите», то есть в том смысле, что уже хуже генерала он и брани не мог найти. Иван Иванович вспылил чрезвычайно: «Да, сударь, я генерал, и генерал-лейтенант, и служил государю моему, а ты, сударь, мальчишка и безбожник!» Произошел скандал непозволительный. На другой день случай был обличен в печати, и начала собираться коллективная подписка против «безобразного поступка» Варвары Петровны, не захотевшей тотчас же прогнать генерала. В иллюстрированном журнале явилась карикатура, в которой язвительно скопировали Варвару Петровну, генерала и Степана Трофимовича на одной картинке, в виде трех ретроградных друзей; к картинке приложены были и стихи, написанные народным поэтом единственно для этого случая. Замечу от себя, что действительно у многих особ в генеральских чинах есть привычка смешно говорить: «Я служил государю моему...», то есть точно у них не тот же государь, как и у нас, простых государевых подданных, а особенный, ихний.",
        "Он со слезами вспоминал об этом девять лет спустя, — впрочем, скорее по художественности своей натуры, чем из благодарности. <said>«Клянусь же вам и пари держу</said>, — говорил он мне сам (но только мне и по секрету), — <said>что никто-то изо всей этой публики знать не знал о мне ровнешенько ничего!»</said> Признание замечательное: стало быть, был же в нем острый ум, если он тогда же, на эстраде, мог так ясно понять свое положение, несмотря на всё свое упоение; и, стало быть, не было в нем острого ума, если он даже девять лет спустя не мог вспомнить о том без ощущения обиды. Его заставили подписаться под двумя или тремя коллективными протестами (против чего — он и сам не знал); он подписался. Варвару Петровну тоже заставили подписаться под каким-то <said>«безобразным поступком»</said>, и та подписалась. Впрочем, большинство этих новых людей хоть и посещали Варвару Петровну, но считали себя почему-то обязанными смотреть на нее с презрением и с нескрываемою насмешкой. Степан Трофимович намекал мне потом, в горькие минуты, что она с тех-то пор ему и позавидовала. Она, конечно, понимала, что ей нельзя водиться с этими людьми, но все-таки принимала их с жадностию, со всем женским истерическим нетерпением и, главное, всё чего-то ждала. На вечерах она говорила мало, хотя и могла бы говорить; но она больше вслушивалась. Говорили об уничтожении цензуры и буквы ъ, о заменении русских букв латинскими, о вчерашней ссылке такого-то, о каком-то скандале в Пассаже, о полезности раздробления России по народностям с вольною федеративною связью, об уничтожении армии и флота, о восстановлении Польши по Днепр, о крестьянской реформе и прокламациях, об уничтожении наследства, семейства, детей и священников, о правах женщины, о доме Краевского, которого никто и никогда не мог простить господину Краевскому, и пр., и пр. Ясно было, что в этом сброде новых людей много мошенников, но несомненно было, что много и честных, весьма даже привлекательных лиц, несмотря на некоторые все-таки удивительные оттенки. Честные были гораздо непонятнее бесчестных и грубых; но неизвестно было, кто у кого в руках. Когда Варвара Петровна объявила свою мысль об издании журнала, то к ней хлынуло еще больше народу, но тотчас же посыпались в глаза обвинения, что она капиталистка и эксплуатирует труд. Бесцеремонность обвинений равнялась только их неожиданности. Престарелый генерал Иван Иванович Дроздов, прежний друг и сослуживец покойного генерала Ставрогина, человек достойнейший (но в своем роде) и которого все мы здесь знаем, до крайности строптивый и раздражительный, ужасно много евший и ужасно боявшийся атеизма, заспорил на одном из вечеров Варвары Петровны с одним знаменитым юношей. Тот ему первым словом: <said>«Вы, стало быть, генерал, если так говорите»</said>, то есть в том смысле, что уже хуже генерала он и брани не мог найти. Иван Иванович вспылил чрезвычайно: <said>«Да, сударь, я генерал, и генерал-лейтенант, и служил государю моему, а ты, сударь, мальчишка и безбожник!»</said> Произошел скандал непозволительный. На другой день случай был обличен в печати, и начала собираться коллективная подписка против <said>«безобразного поступка»</said> Варвары Петровны, не захотевшей тотчас же прогнать генерала. В иллюстрированном журнале явилась карикатура, в которой язвительно скопировали Варвару Петровну, генерала и Степана Трофимовича на одной картинке, в виде трех ретроградных друзей; к картинке приложены были и стихи, написанные народным поэтом единственно для этого случая. Замечу от себя, что действительно у многих особ в генеральских чинах есть привычка смешно говорить: <said>«Я служил государю моему...»</said>, то есть точно у них не тот же государь, как и у нас, простых государевых подданных, а особенный, ихний.",
    ),
    (
        "— Да, там нет крючьев, — тихо и серьезно, приглядываясь к отцу, выговорил Алеша. — Так, так, одни только тени крючьев. Знаю, знаю. Это как один француз описывал ад: «J’ai vu l'ombre d’un cocher, qui avec l’ombre d’une brosse frottait l’ombre d’une carrosse». Ты, голубчик, почему знаешь, что нет крючьев? Побудешь у монахов, не то запоешь. А впрочем, ступай, доберись там до правды, да и приди рассказать: всё же идти на тот свет будет легче, коли наверно знаешь, что там такое. Да и приличнее тебе будет у монахов, чем у меня, с пьяным старикашкой да с девчонками... хоть до тебя, как до ангела, ничего не коснется. Ну авось и там до тебя ничего не коснется, вот ведь я почему и дозволяю тебе, что на последнее надеюсь. Ум-то у тебя не черт съел. Погоришь и погаснешь, вылечишься и назад придешь. А я тебя буду ждать: ведь я чувствую же, что ты единственный человек на земле, который меня не осудил, мальчик ты мой милый, я ведь чувствую же это, не могу же я это не чувствовать!..",
        "— <said>Да, там нет крючьев</said>, — тихо и серьезно, приглядываясь к отцу, выговорил Алеша. — <said>Так, так, одни только тени крючьев. Знаю, знаю. Это как один француз описывал ад: <said>«J’ai vu l'ombre d’un cocher, qui avec l’ombre d’une brosse frottait l’ombre d’une carrosse»</said>. Ты, голубчик, почему знаешь, что нет крючьев? Побудешь у монахов, не то запоешь. А впрочем, ступай, доберись там до правды, да и приди рассказать: всё же идти на тот свет будет легче, коли наверно знаешь, что там такое. Да и приличнее тебе будет у монахов, чем у меня, с пьяным старикашкой да с девчонками... хоть до тебя, как до ангела, ничего не коснется. Ну авось и там до тебя ничего не коснется, вот ведь я почему и дозволяю тебе, что на последнее надеюсь. Ум-то у тебя не черт съел. Погоришь и погаснешь, вылечишься и назад придешь. А я тебя буду ждать: ведь я чувствую же, что ты единственный человек на земле, который меня не осудил, мальчик ты мой милый, я ведь чувствую же это, не могу же я это не чувствовать!..</said>",
    ),
    (
        "— Только и говорит мне намедни Степанида Ильинишна Бедрягина, купчиха она, богатая: возьми ты, говорит, Прохоровна, и запиши ты, говорит, сыночка своего в поминанье, снеси в церковь, да и помяни за упокой. Душа-то его, говорит, затоскует, он и напишет письмо. «И это, — говорит Степанида Ильинишна, — как есть верно, многократно испытано». Да только я сумлеваюсь... Свет ты наш, правда оно аль неправда, и хорошо ли так будет?",
        "— <said>Только и говорит мне намедни Степанида Ильинишна Бедрягина, купчиха она, богатая: возьми ты, говорит, Прохоровна, и запиши ты, говорит, сыночка своего в поминанье, снеси в церковь, да и помяни за упокой. Душа-то его, говорит, затоскует, он и напишет письмо. <said>«И это</said>, — говорит Степанида Ильинишна, — <said>как есть верно, многократно испытано»</said>. Да только я сумлеваюсь... Свет ты наш, правда оно аль неправда, и хорошо ли так будет?</said>",
    ),
    (
        "«Накорми, тогда и спрашивай с них добродетели!» — вот что напишут на знамени, которое воздвигнут против тебя и которым разрушится храм твой. На месте храма твоего воздвигнется новое здание, воздвигнется вновь страшная Вавилонская башня, и хотя и эта не достроится, как и прежняя, но всё же ты бы мог избежать этой новой башни и на тысячу лет сократить страдания людей, ибо к нам же ведь придут они, промучившись тысячу лет со своей башней!»",
        "<said>«Накорми, тогда и спрашивай с них добродетели!»</said> — вот что напишут на знамени, которое воздвигнут против тебя и которым разрушится храм твой. На месте храма твоего воздвигнется новое здание, воздвигнется вновь страшная Вавилонская башня, и хотя и эта не достроится, как и прежняя, но всё же ты бы мог избежать этой новой башни и на тысячу лет сократить страдания людей, ибо к нам же ведь придут они, промучившись тысячу лет со своей башней!»",
    ),
    (
        '«...Глагола ей Иисус: что есть мне у тебе, жено; не у прииде час мой. Глагола мати его слугам: еже аще глаголет вам, сотворите». «Сотворите... Радость, радость каких-нибудь бедных, очень бедных людей... Уж конечно, бедных, коли даже на свадьбу вина недостало... Вон пишут историки, что около озера Генисаретского и во всех тех местах расселено было тогда самое беднейшее население, какое только можно вообразить... И знало же другое великое сердце другого великого существа, бывшего тут же, матери его, что не для одного лишь великого страшного подвига своего сошел он тогда, а что доступно сердцу его и простодушное немудрое веселие каких-нибудь темных, темных и нехитрых существ, ласково позвавших его на убогий брак их. "Не пришел еще час мой", — он говорит с тихою улыбкой (непременно улыбнулся ей кротко)... В самом деле, неужто для того, чтоб умножать вино на бедных свадьбах, сошел он на землю? А вот пошел же и сделал же по ее просьбе.. Ах, он опять читает».',
        '<said>«...Глагола ей Иисус: что есть мне у тебе, жено; не у прииде час мой. Глагола мати его слугам: еже аще глаголет вам, сотворите»</said>. <said>«Сотворите... Радость, радость каких-нибудь бедных, очень бедных людей... Уж конечно, бедных, коли даже на свадьбу вина недостало... Вон пишут историки, что около озера Генисаретского и во всех тех местах расселено было тогда самое беднейшее население, какое только можно вообразить... И знало же другое великое сердце другого великого существа, бывшего тут же, матери его, что не для одного лишь великого страшного подвига своего сошел он тогда, а что доступно сердцу его и простодушное немудрое веселие каких-нибудь темных, темных и нехитрых существ, ласково позвавших его на убогий брак их. <said>"Не пришел еще час мой"</said>, — он говорит с тихою улыбкой (непременно улыбнулся ей кротко)... В самом деле, неужто для того, чтоб умножать вино на бедных свадьбах, сошел он на землю? А вот пошел же и сделал же по ее просьбе.. Ах, он опять читает»</said>.',
    ),
    (
        '«"И только шепчет тишина", — мелькнул почему-то этот стишок в голове его, — вот только не услышал бы кто, как я перескочил; кажется, нет». Постояв минутку, он тихонько пошел по саду, по траве; обходя деревья и кусты, шел долго, скрадывая каждый шаг, к каждому шагу своему сам прислушиваясь. Минут с пять добирался он до освещенного окна. Он помнил, что там под самыми окнами есть несколько больших, высоких, густых кустов бузины и калины. Выходная дверь из дома в сад в левой стороне фасада была заперта, и он это нарочно и тщательно высмотрел проходя. Наконец достиг и кустов и притаился за ними. Он не дышал. «Переждать теперь надобно, — подумал он, — если они слышали мои шаги и теперь прислушиваются, то чтобы разуверились... как бы только не кашлянуть, не чихнуть...»',
        '<said>«"И только шепчет тишина"</said>, — мелькнул почему-то этот стишок в голове его, — <said>вот только не услышал бы кто, как я перескочил; кажется, нет»</said>. Постояв минутку, он тихонько пошел по саду, по траве; обходя деревья и кусты, шел долго, скрадывая каждый шаг, к каждому шагу своему сам прислушиваясь. Минут с пять добирался он до освещенного окна. Он помнил, что там под самыми окнами есть несколько больших, высоких, густых кустов бузины и калины. Выходная дверь из дома в сад в левой стороне фасада была заперта, и он это нарочно и тщательно высмотрел проходя. Наконец достиг и кустов и притаился за ними. Он не дышал. <said>«Переждать теперь надобно</said>, — подумал он, — <said>если они слышали мои шаги и теперь прислушиваются, то чтобы разуверились... как бы только не кашлянуть, не чихнуть...»</said>',
    ),
    (
        "«Тут и сам станешь юродивым! Заразительно!» — подумал он. — Читай! — воскликнул он вдруг настойчиво и раздражительно.",
        "<said>«Тут и сам станешь юродивым! Заразительно!»</said> — подумал он. — <said>Читай!</said> — воскликнул он вдруг настойчиво и раздражительно.",
    ),
    (
        "Подробностей не знаю, но слышал лишь то, что будто воспитанницу, кроткую, незлобивую и безответную, раз сняли с петли, которую она привесила на гвозде в чулане, — до того тяжело было ей переносить своенравие и вечные попреки этой, по-видимому не злой, старухи, но бывшей лишь нестерпимейшею самодуркой от праздности. Федор Павлович предложил свою руку, о нем справились и его прогнали, и вот тут-то он опять, как и в первом браке, предложил сиротке увоз. Очень, очень может быть, что и она даже не пошла бы за него ни за что, если б узнала о нем своевременно побольше подробностей. Но дело было в другой губернии; да и что могла понимать шестнадцатилетняя девочка, кроме того, что лучше в реку, чем оставаться у благодетельницы. Так и променяла бедняжка благодетельницу на благодетеля. Федор Павлович не взял в этот раз ни гроша, потому что генеральша рассердилась, ничего не дала и, сверх того, прокляла их обоих; но он и не рассчитывал на этот раз взять, а прельстился лишь замечательною красотой невинной девочки и, главное, ее невинным видом, поразившим его, сладострастника и доселе порочного любителя лишь грубой женской красоты. «Меня эти невинные глазки как бритвой тогда по душе полоснули», — говаривал он потом, гадко по-своему хихикая.",
        "Подробностей не знаю, но слышал лишь то, что будто воспитанницу, кроткую, незлобивую и безответную, раз сняли с петли, которую она привесила на гвозде в чулане, — до того тяжело было ей переносить своенравие и вечные попреки этой, по-видимому не злой, старухи, но бывшей лишь нестерпимейшею самодуркой от праздности. Федор Павлович предложил свою руку, о нем справились и его прогнали, и вот тут-то он опять, как и в первом браке, предложил сиротке увоз. Очень, очень может быть, что и она даже не пошла бы за него ни за что, если б узнала о нем своевременно побольше подробностей. Но дело было в другой губернии; да и что могла понимать шестнадцатилетняя девочка, кроме того, что лучше в реку, чем оставаться у благодетельницы. Так и променяла бедняжка благодетельницу на благодетеля. Федор Павлович не взял в этот раз ни гроша, потому что генеральша рассердилась, ничего не дала и, сверх того, прокляла их обоих; но он и не рассчитывал на этот раз взять, а прельстился лишь замечательною красотой невинной девочки и, главное, ее невинным видом, поразившим его, сладострастника и доселе порочного любителя лишь грубой женской красоты. <said>«Меня эти невинные глазки как бритвой тогда по душе полоснули»</said>, — говаривал он потом, гадко по-своему хихикая.",
    ),
]


@pytest.mark.parametrize("source,expected", examples, ids=lambda v: v[:20])
def test_direct_speech(source, expected):
    source = "\n".join(l.strip("\n\t ") for l in source.splitlines()).strip(" \n")
    expected = expected.replace(
        "<said>", "<said {}>".format(" ".join(f'{k}=""' for k in ATTRIBS))
    )
    expected = expected.strip(" \n")
    assert markup_direct_speech(source) == expected


if __name__ == "__main__":
    # Sometimes this is easier to develop against than using pytest properly...
    # <TEI/> tags are for the sake of IDE linters and syntax highlighters.
    print("<TEI>")
    for source, expected in examples:
        source = "\n".join(l.strip("\n\t ") for l in source.splitlines()).strip(" \n")
        markedup = markup_direct_speech(source)
        expected = expected.replace(
            "<said>", "<said {}>".format(" ".join(f'{k}=""' for k in ATTRIBS))
        )
        expected = expected.strip(" \n")
        if expected != markedup:
            print(source)
            print("=" * len(source))
            print(expected)
            print("")
            print(markedup)
            print("\n\n")
    print("</TEI>")
